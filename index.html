<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬°Practica las Multiplicaciones! üéØ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .medals {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .medal {
            font-size: 3em;
            opacity: 0.3;
            transition: all 0.5s;
        }

        .medal.earned {
            opacity: 1;
            animation: bounce 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Secci√≥n de normas de medallas */
        .medals-info {
            background: #fff3cd;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            transition: all 0.3s;
            overflow: hidden;
            border: 3px solid #ffc107;
        }

        .medals-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .medals-info-header h3 {
            color: #856404;
            font-size: 1.2em;
            margin: 0;
        }

        .medals-info-content {
            max-height: 300px;
            opacity: 1;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .medals-info-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            overflow: hidden;
        }

        .medal-requirement {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 5px solid #ffc107;
        }

        .medal-requirement .medal-icon {
            font-size: 2.5em;
        }

        .medal-requirement .medal-text {
            text-align: left;
        }

        .medal-requirement .medal-name {
            font-weight: bold;
            color: #856404;
            font-size: 1.1em;
        }

        .medal-requirement .medal-desc {
            color: #666;
            font-size: 0.9em;
        }

        .table-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            transition: all 0.3s;
            overflow: hidden;
        }

        .table-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .table-selector-header h3 {
            color: #667eea;
            font-size: 1.2em;
            margin: 0;
        }

        .toggle-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .toggle-btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .toggle-btn.medals {
            background: #ffc107;
            color: #856404;
        }

        .toggle-btn.medals:hover {
            background: #ffb300;
        }

        .table-selector-content {
            max-height: 400px;
            opacity: 1;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .table-selector-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            overflow: hidden;
        }

        .table-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .table-btn {
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
            color: #667eea;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
        }

        .table-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .table-btn.active {
            background: #667eea;
            color: white;
        }

        .table-selection-mode {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #2196F3;
        }

        .mode-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 10px;
        }

        .mode-btn {
            padding: 8px 20px;
            border: 2px solid #2196F3;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            color: #2196F3;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
        }

        .mode-btn.active {
            background: #2196F3;
            color: white;
        }

        .selected-tables-display {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-weight: bold;
            color: #2196F3;
            min-height: 30px;
        }

        .timer-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid #ffc107;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .timer-display {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
            margin: 10px 0;
        }

        .timer-btn {
            padding: 10px 20px;
            background: #ffc107;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            font-size: 1em;
        }

        .timer-btn:hover {
            background: #ffb300;
            transform: translateY(-2px);
        }

        .btn-stop {
            background: #dc3545;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
        }

        .btn-stop:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            background: #f0f0f0;
            padding: 15px;
            border-radius: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .question-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            font-size: 3em;
            font-weight: bold;
            color: #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .question-box.correct-answer {
            background: linear-gradient(135deg, #d4edda 0%, #a8e063 100%);
            animation: celebrate 0.5s;
        }

        .question-box.incorrect-answer {
            background: linear-gradient(135deg, #f8d7da 0%, #ff6b6b 100%);
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .mystery {
            color: #ff6b6b;
            animation: pulse 1s infinite;
        }

        .mystery.revealed {
            color: #28a745;
            animation: none;
            font-size: 1.2em;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .answer-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Teclado num√©rico - BOTONES M√ÅS PEQUE√ëOS */
        .number-keyboard {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            max-width: 400px;
            margin: 20px auto;
        }

        .number-btn {
            padding: 12px;
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.3);
        }

        .number-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(102, 126, 234, 0.4);
        }

        .number-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(102, 126, 234, 0.3);
        }

        .number-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .number-btn.correct {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            animation: celebrate 0.5s;
        }

        .number-btn.incorrect {
            background: linear-gradient(135deg, #dc3545 0%, #ff6b6b 100%);
            animation: shake 0.5s;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }

        .message {
            font-size: 1.5em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            font-weight: bold;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message.correct {
            background: #d4edda;
            color: #155724;
            border: 3px solid #28a745;
        }

        .message.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 3px solid #dc3545;
        }

        .message.empty {
            background: transparent;
            border: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #56ab2f 0%, #a8e063 100%);
            width: 0%;
            transition: width 0.5s;
        }

        /* Estilos para el reporte */
        .report-container {
            display: none;
            text-align: left;
        }

        .report-container.active {
            display: block;
        }

        .report-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .report-header h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .report-stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #667eea;
        }

        .report-stat-card h3 {
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .report-stat-card .big-number {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
        }

        .failed-questions {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .failed-questions h3 {
            color: #856404;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .failed-question-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 5px solid #dc3545;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .failed-question-text {
            font-size: 1.2em;
            font-weight: bold;
        }

        .failed-answer {
            color: #dc3545;
            font-size: 1.1em;
        }

        .correct-answer-text {
            color: #28a745;
            font-size: 1.1em;
            font-weight: bold;
        }

        .btn-restart {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            width: 100%;
        }

        .btn-restart:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .practice-area {
            display: block;
        }

        .practice-area.hidden {
            display: none;
        }

        .no-failed {
            text-align: center;
            padding: 30px;
            color: #28a745;
            font-size: 1.3em;
        }

        .session-history {
            background: #e7f3ff;
            border: 3px solid #2196F3;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .session-history h3 {
            color: #2196F3;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .history-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-date {
            font-weight: bold;
            color: #667eea;
        }

        .history-stats {
            display: flex;
            gap: 20px;
        }

        .history-stat {
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- √Årea de pr√°ctica -->
        <div class="practice-area" id="practice-area">
            <h1>üéØ ¬°Practica las Multiplicaciones! üéØ</h1>
            <p class="subtitle">¬°Toca el n√∫mero correcto!</p>

            <!-- Medallas -->
            <div class="medals">
                <span class="medal" id="medal-bronze" title="Bronce: 5 correctas">ü•â</span>
                <span class="medal" id="medal-silver" title="Plata: 10 correctas">ü•à</span>
                <span class="medal" id="medal-gold" title="Oro: 20 correctas">ü•á</span>
                <span class="medal" id="medal-trophy" title="Trofeo: 50 correctas">üèÜ</span>
            </div>

            <!-- Normas de las medallas (ocultable) -->
            <div class="medals-info">
                <div class="medals-info-header" onclick="toggleMedalsInfo()">
                    <h3>üèÖ ¬øC√≥mo conseguir las medallas?</h3>
                    <button class="toggle-btn medals" id="medals-toggle-btn">Ocultar ‚ñ≤</button>
                </div>
                <div class="medals-info-content" id="medals-info-content">
                    <div class="medal-requirement">
                        <div class="medal-icon">ü•â</div>
                        <div class="medal-text">
                            <div class="medal-name">Medalla de Bronce</div>
                            <div class="medal-desc">Consigue 5 respuestas correctas</div>
                        </div>
                    </div>
                    <div class="medal-requirement">
                        <div class="medal-icon">ü•à</div>
                        <div class="medal-text">
                            <div class="medal-name">Medalla de Plata</div>
                            <div class="medal-desc">Consigue 10 respuestas correctas</div>
                        </div>
                    </div>
                    <div class="medal-requirement">
                        <div class="medal-icon">ü•á</div>
                        <div class="medal-text">
                            <div class="medal-name">Medalla de Oro</div>
                            <div class="medal-desc">Consigue 20 respuestas correctas</div>
                        </div>
                    </div>
                    <div class="medal-requirement">
                        <div class="medal-icon">üèÜ</div>
                        <div class="medal-text">
                            <div class="medal-name">Copa de Campe√≥n</div>
                            <div class="medal-desc">Consigue 50 respuestas correctas - ¬°Eres un maestro!</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Selector de tablas (ocultable) CON SELECCI√ìN M√öLTIPLE -->
            <div class="table-selector">
                <div class="table-selector-header" onclick="toggleTableSelector()">
                    <h3>üìö Elige qu√© tabla practicar:</h3>
                    <button class="toggle-btn" id="toggle-btn">Ocultar ‚ñ≤</button>
                </div>
                <div class="table-selector-content" id="table-selector-content">
                    <!-- Modo de selecci√≥n -->
                    <div class="table-selection-mode">
                        <div class="mode-buttons">
                            <button class="mode-btn active" id="mode-single" onclick="setSelectionMode('single')">Tabla Individual</button>
                            <button class="mode-btn" id="mode-multiple" onclick="setSelectionMode('multiple')">Varias Tablas</button>
                        </div>
                        <div class="selected-tables-display" id="selected-display">
                            Todas las tablas seleccionadas
                        </div>
                    </div>

                    <div class="table-buttons">
                        <button class="table-btn active" onclick="selectTable('all')">Todas</button>
                        <button class="table-btn" onclick="selectTable(2)">Tabla del 2</button>
                        <button class="table-btn" onclick="selectTable(3)">Tabla del 3</button>
                        <button class="table-btn" onclick="selectTable(4)">Tabla del 4</button>
                        <button class="table-btn" onclick="selectTable(5)">Tabla del 5</button>
                        <button class="table-btn" onclick="selectTable(6)">Tabla del 6</button>
                        <button class="table-btn" onclick="selectTable(7)">Tabla del 7</button>
                        <button class="table-btn" onclick="selectTable(8)">Tabla del 8</button>
                        <button class="table-btn" onclick="selectTable(9)">Tabla del 9</button>
                    </div>
                </div>
            </div>

            <!-- Temporizador y Bot√≥n Detener -->
            <div class="timer-section">
                <div class="timer-controls">
                    <button class="timer-btn" id="timer-btn" onclick="toggleTimer()">‚è±Ô∏è Activar Cron√≥metro</button>
                    <span class="timer-display" id="timer">0s</span>
                    <button class="btn-stop" onclick="stopPractice()">üõë Detener Pr√°ctica</button>
                </div>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="correct-count">0</div>
                    <div class="stat-label">‚úÖ Correctas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="total-count">0</div>
                    <div class="stat-label">üìä Total</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="percentage">0%</div>
                    <div class="stat-label">üåü Aciertos</div>
                </div>
            </div>

            <div class="question-box" id="question-box">
                <span class="mystery" id="mystery">?</span> √ó <span id="known-number">5</span> = <span id="result">35</span>
            </div>

            <div class="answer-display" id="answer-display">
                Selecciona tu respuesta
            </div>

            <!-- Teclado num√©rico - BOTONES M√ÅS PEQUE√ëOS -->
            <div class="number-keyboard">
                <button class="number-btn" id="btn-0" onclick="selectAnswer(0)">0</button>
                <button class="number-btn" id="btn-1" onclick="selectAnswer(1)">1</button>
                <button class="number-btn" id="btn-2" onclick="selectAnswer(2)">2</button>
                <button class="number-btn" id="btn-3" onclick="selectAnswer(3)">3</button>
                <button class="number-btn" id="btn-4" onclick="selectAnswer(4)">4</button>
                <button class="number-btn" id="btn-5" onclick="selectAnswer(5)">5</button>
                <button class="number-btn" id="btn-6" onclick="selectAnswer(6)">6</button>
                <button class="number-btn" id="btn-7" onclick="selectAnswer(7)">7</button>
                <button class="number-btn" id="btn-8" onclick="selectAnswer(8)">8</button>
                <button class="number-btn" id="btn-9" onclick="selectAnswer(9)">9</button>
            </div>

            <div class="message empty" id="message">Toca un n√∫mero para responder</div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
        </div>

        <!-- √Årea de reporte -->
        <div class="report-container" id="report-container">
            <div class="report-header">
                <h2>üìä Reporte de Pr√°ctica</h2>
                <p style="font-size: 1.2em;">¬°Excelente trabajo! Aqu√≠ est√° tu resumen:</p>
            </div>

            <div class="report-stats">
                <div class="report-stat-card">
                    <h3>‚è±Ô∏è Tiempo Total</h3>
                    <div class="big-number" id="report-time">0s</div>
                </div>
                <div class="report-stat-card">
                    <h3>‚úÖ Correctas</h3>
                    <div class="big-number" id="report-correct">0</div>
                </div>
                <div class="report-stat-card">
                    <h3>‚ùå Incorrectas</h3>
                    <div class="big-number" id="report-incorrect">0</div>
                </div>
                <div class="report-stat-card">
                    <h3>üåü Porcentaje</h3>
                    <div class="big-number" id="report-percentage">0%</div>
                </div>
            </div>

            <div class="failed-questions" id="failed-questions-section">
                <h3>‚ùå Preguntas que fallaste:</h3>
                <div id="failed-questions-list"></div>
            </div>

            <button class="btn-restart" onclick="restartPractice()">üîÑ Iniciar Nueva Pr√°ctica</button>

            <div class="session-history" id="session-history">
                <h3>üìö Historial de Sesiones (Ordenado por Rendimiento)</h3>
                <div id="history-list"></div>
            </div>
        </div>
    </div>

    <script>
        let correctAnswers = 0;
        let totalQuestions = 0;
        let currentAnswer = 0;
        let selectedTables = ['all']; // Ahora es un array para soportar m√∫ltiples tablas
        let selectionMode = 'single'; // 'single' o 'multiple'
        let timerActive = false;
        let timerSeconds = 0;
        let timerInterval = null;
        let failedQuestions = [];
        let sessionHistory = [];
        let practiceStartTime = null;
        let tableSelectorCollapsed = false;
        let medalsInfoCollapsed = false;
        let buttonsDisabled = false;

        function loadHistory() {
            const saved = localStorage.getItem('multiplicacionesHistory');
            if (saved) {
                sessionHistory = JSON.parse(saved);
            }
        }

        function saveHistory() {
            localStorage.setItem('multiplicacionesHistory', JSON.stringify(sessionHistory));
        }

        function toggleTableSelector() {
            tableSelectorCollapsed = !tableSelectorCollapsed;
            const content = document.getElementById('table-selector-content');
            const btn = document.getElementById('toggle-btn');
            
            if (tableSelectorCollapsed) {
                content.classList.add('collapsed');
                btn.textContent = 'Mostrar ‚ñº';
            } else {
                content.classList.remove('collapsed');
                btn.textContent = 'Ocultar ‚ñ≤';
            }
        }

        function toggleMedalsInfo() {
            medalsInfoCollapsed = !medalsInfoCollapsed;
            const content = document.getElementById('medals-info-content');
            const btn = document.getElementById('medals-toggle-btn');
            
            if (medalsInfoCollapsed) {
                content.classList.add('collapsed');
                btn.textContent = 'Mostrar ‚ñº';
            } else {
                content.classList.remove('collapsed');
                btn.textContent = 'Ocultar ‚ñ≤';
            }
        }

        function setSelectionMode(mode) {
            selectionMode = mode;
            
            // Actualizar botones de modo
            document.getElementById('mode-single').classList.remove('active');
            document.getElementById('mode-multiple').classList.remove('active');
            document.getElementById('mode-' + mode).classList.add('active');
            
            // Resetear selecci√≥n
            selectedTables = mode === 'single' ? ['all'] : [];
            
            // Actualizar UI
            document.querySelectorAll('.table-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (mode === 'single') {
                document.querySelector('.table-btn').classList.add('active'); // Todas
            }
            
            updateSelectedDisplay();
            generateQuestion();
        }

        function selectTable(table) {
            if (selectionMode === 'single') {
                // Modo individual: solo una tabla
                selectedTables = [table];
                document.querySelectorAll('.table-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            } else {
                // Modo m√∫ltiple: varias tablas
                const index = selectedTables.indexOf(table);
                
                if (table === 'all') {
                    // Si selecciona "Todas", deseleccionar todo lo dem√°s
                    selectedTables = ['all'];
                    document.querySelectorAll('.table-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    event.target.classList.add('active');
                } else {
                    // Quitar "Todas" si selecciona una tabla espec√≠fica
                    const allIndex = selectedTables.indexOf('all');
                    if (allIndex > -1) {
                        selectedTables.splice(allIndex, 1);
                        document.querySelector('.table-btn').classList.remove('active');
                    }
                    
                    if (index > -1) {
                        // Deseleccionar
                        selectedTables.splice(index, 1);
                        event.target.classList.remove('active');
                    } else {
                        // Seleccionar
                        selectedTables.push(table);
                        event.target.classList.add('active');
                    }
                    
                    // Si no hay nada seleccionado, volver a "Todas"
                    if (selectedTables.length === 0) {
                        selectedTables = ['all'];
                        document.querySelector('.table-btn').classList.add('active');
                    }
                }
            }
            
            updateSelectedDisplay();
            generateQuestion();
        }

        function updateSelectedDisplay() {
            const display = document.getElementById('selected-display');
            
            if (selectedTables.includes('all')) {
                display.textContent = 'Todas las tablas seleccionadas';
            } else if (selectedTables.length === 1) {
                display.textContent = `Tabla del ${selectedTables[0]} seleccionada`;
            } else {
                display.textContent = `Tablas seleccionadas: ${selectedTables.sort((a,b) => a-b).join(', ')}`;
            }
        }

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSuccessSound() {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 523.25;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
                
                setTimeout(() => {
                    const osc2 = audioContext.createOscillator();
                    const gain2 = audioContext.createGain();
                    osc2.connect(gain2);
                    gain2.connect(audioContext.destination);
                    osc2.frequency.value = 659.25;
                    osc2.type = 'sine';
                    gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    osc2.start(audioContext.currentTime);
                    osc2.stop(audioContext.currentTime + 0.3);
                }, 150);
            } catch (e) {
                console.log('Audio no disponible');
            }
        }

        function playErrorSound() {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 200;
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (e) {
                console.log('Audio no disponible');
            }
        }

        function toggleTimer() {
            timerActive = !timerActive;
            const btn = document.getElementById('timer-btn');
            
            if (timerActive) {
                btn.textContent = '‚è∏Ô∏è Pausar Cron√≥metro';
                startTimer();
            } else {
                btn.textContent = '‚è±Ô∏è Activar Cron√≥metro';
                stopTimer();
            }
        }

        function startTimer() {
            if (!practiceStartTime) {
                practiceStartTime = Date.now();
            }
            timerInterval = setInterval(() => {
                timerSeconds++;
                document.getElementById('timer').textContent = formatTime(timerSeconds);
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            if (mins > 0) {
                return `${mins}m ${secs}s`;
            }
            return `${secs}s`;
        }

        function updateMedals() {
            const medals = [
                { id: 'medal-bronze', threshold: 5 },
                { id: 'medal-silver', threshold: 10 },
                { id: 'medal-gold', threshold: 20 },
                { id: 'medal-trophy', threshold: 50 }
            ];

            medals.forEach(medal => {
                const element = document.getElementById(medal.id);
                if (correctAnswers >= medal.threshold && !element.classList.contains('earned')) {
                    element.classList.add('earned');
                    playMedalSound();
                }
            });
        }

        function playMedalSound() {
            try {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = 523.25 * (i + 1);
                        osc.type = 'sine';
                        gain.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        osc.start(audioContext.currentTime);
                        osc.stop(audioContext.currentTime + 0.3);
                    }, i * 100);
                }
            } catch (e) {
                console.log('Audio no disponible');
            }
        }

        function generateQuestion() {
            let num1, num2;
            
            if (selectedTables.includes('all')) {
                // Todas las tablas
                num1 = Math.floor(Math.random() * 8) + 2;
                num2 = Math.floor(Math.random() * 8) + 2;
            } else {
                // Tablas seleccionadas
                const randomTable = selectedTables[Math.floor(Math.random() * selectedTables.length)];
                num1 = randomTable;
                num2 = Math.floor(Math.random() * 8) + 2;
            }
            
            const result = num1 * num2;
            const showFirst = Math.random() < 0.5;

            if (showFirst) {
                document.getElementById('known-number').textContent = num1;
                document.getElementById('result').textContent = result;
                currentAnswer = num2;
            } else {
                document.getElementById('known-number').textContent = num2;
                document.getElementById('result').textContent = result;
                currentAnswer = num1;
            }

            // Resetear UI
            const mysteryElement = document.getElementById('mystery');
            mysteryElement.textContent = '?';
            mysteryElement.className = 'mystery';
            document.getElementById('answer-display').textContent = 'Selecciona tu respuesta';
            document.getElementById('message').className = 'message empty';
            document.getElementById('message').textContent = 'Toca un n√∫mero para responder';
            document.getElementById('question-box').className = 'question-box';
            
            // Resetear botones
            for (let i = 0; i <= 9; i++) {
                const btn = document.getElementById('btn-' + i);
                btn.className = 'number-btn';
                btn.disabled = false;
            }
            
            buttonsDisabled = false;
        }

        function selectAnswer(userAnswer) {
            if (buttonsDisabled) return;
            
            buttonsDisabled = true;
            totalQuestions++;
            document.getElementById('total-count').textContent = totalQuestions;

            // Mostrar la respuesta seleccionada
            document.getElementById('answer-display').textContent = userAnswer;

            const num1 = parseInt(document.getElementById('known-number').textContent);
            const result = parseInt(document.getElementById('result').textContent);
            const messageDiv = document.getElementById('message');
            const questionBox = document.getElementById('question-box');
            const selectedBtn = document.getElementById('btn-' + userAnswer);
            const mysteryElement = document.getElementById('mystery');

            // Deshabilitar todos los botones
            for (let i = 0; i <= 9; i++) {
                document.getElementById('btn-' + i).disabled = true;
            }

            if (userAnswer === currentAnswer) {
                // RESPUESTA CORRECTA - 2 segundos
                correctAnswers++;
                const messages = [
                    'üéâ ¬°CORRECTO! ¬°Excelente! üåü',
                    'üéä ¬°Perfecto! ¬°Eres un campe√≥n! üèÜ',
                    '‚≠ê ¬°Genial! ¬°Muy bien! üí™',
                    'üåü ¬°Fant√°stico! ¬°Sigue as√≠! üéØ',
                    'üéà ¬°Incre√≠ble! ¬°Muy inteligente! üß†'
                ];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                messageDiv.textContent = randomMessage;
                messageDiv.className = 'message correct';
                questionBox.classList.add('correct-answer');
                selectedBtn.classList.add('correct');
                document.getElementById('correct-count').textContent = correctAnswers;
                playSuccessSound();
                updateMedals();

                // Generar nueva pregunta despu√©s de 2 segundos
                setTimeout(() => {
                    generateQuestion();
                }, 2000);
            } else {
                // RESPUESTA INCORRECTA - 4 segundos
                failedQuestions.push({
                    question: `${currentAnswer} √ó ${num1} = ${result}`,
                    userAnswer: userAnswer,
                    correctAnswer: currentAnswer
                });

                // Revelar la respuesta correcta en el signo de interrogaci√≥n
                mysteryElement.textContent = currentAnswer;
                mysteryElement.className = 'mystery revealed';

                messageDiv.textContent = `‚ùå Incorrecto. La respuesta correcta es ${currentAnswer}`;
                messageDiv.className = 'message incorrect';
                questionBox.classList.add('incorrect-answer');
                selectedBtn.classList.add('incorrect');
                playErrorSound();

                // Generar nueva pregunta despu√©s de 4 segundos
                setTimeout(() => {
                    generateQuestion();
                }, 4000);
            }

            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            document.getElementById('percentage').textContent = percentage + '%';
            document.getElementById('progress').style.width = percentage + '%';
        }

        function stopPractice() {
            if (totalQuestions === 0) {
                alert('¬°Debes responder al menos una pregunta antes de detener la pr√°ctica!');
                return;
            }

            if (timerActive) {
                toggleTimer();
            }

            const session = {
                date: new Date().toLocaleString('es-ES'),
                time: timerSeconds,
                correct: correctAnswers,
                incorrect: totalQuestions - correctAnswers,
                total: totalQuestions,
                percentage: Math.round((correctAnswers / totalQuestions) * 100),
                failedCount: failedQuestions.length
            };

            sessionHistory.unshift(session);
            if (sessionHistory.length > 10) {
                sessionHistory = sessionHistory.slice(0, 10);
            }
            saveHistory();

            showReport();
        }

        function showReport() {
            document.getElementById('practice-area').classList.add('hidden');
            document.getElementById('report-container').classList.add('active');

            document.getElementById('report-time').textContent = formatTime(timerSeconds);
            document.getElementById('report-correct').textContent = correctAnswers;
            document.getElementById('report-incorrect').textContent = totalQuestions - correctAnswers;
            document.getElementById('report-percentage').textContent = Math.round((correctAnswers / totalQuestions) * 100) + '%';

            const failedListDiv = document.getElementById('failed-questions-list');

            if (failedQuestions.length === 0) {
                failedListDiv.innerHTML = '<div class="no-failed">üéâ ¬°Perfecto! No fallaste ninguna pregunta.</div>';
            } else {
                failedListDiv.innerHTML = '';
                failedQuestions.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'failed-question-item';
                    div.innerHTML = `
                        <div>
                            <div class="failed-question-text">${item.question}</div>
                            <div>Tu respuesta: <span class="failed-answer">${item.userAnswer}</span> | 
                            Correcta: <span class="correct-answer-text">${item.correctAnswer}</span></div>
                        </div>
                    `;
                    failedListDiv.appendChild(div);
                });
            }

            displayHistory();
        }

        function displayHistory() {
            const historyListDiv = document.getElementById('history-list');
            
            if (sessionHistory.length === 0) {
                historyListDiv.innerHTML = '<p style="text-align: center; color: #666;">A√∫n no hay sesiones guardadas.</p>';
                return;
            }

            const sortedHistory = [...sessionHistory].sort((a, b) => b.percentage - a.percentage);

            historyListDiv.innerHTML = '';
            sortedHistory.forEach((session, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                let medal = '';
                if (index === 0) medal = 'ü•á';
                else if (index === 1) medal = 'ü•à';
                else if (index === 2) medal = 'ü•â';

                div.innerHTML = `
                    <div>
                        <div class="history-date">${medal} ${session.date}</div>
                    </div>
                    <div class="history-stats">
                        <div class="history-stat">‚è±Ô∏è ${formatTime(session.time)}</div>
                        <div class="history-stat">‚úÖ ${session.correct}/${session.total}</div>
                        <div class="history-stat">üåü ${session.percentage}%</div>
                    </div>
                `;
                historyListDiv.appendChild(div);
            });
        }

        function restartPractice() {
            correctAnswers = 0;
            totalQuestions = 0;
            timerSeconds = 0;
            failedQuestions = [];
            practiceStartTime = null;
            timerActive = false;
            buttonsDisabled = false;

            document.querySelectorAll('.medal').forEach(medal => {
                medal.classList.remove('earned');
            });

            document.getElementById('correct-count').textContent = '0';
            document.getElementById('total-count').textContent = '0';
            document.getElementById('percentage').textContent = '0%';
            document.getElementById('timer').textContent = '0s';
            document.getElementById('timer-btn').textContent = '‚è±Ô∏è Activar Cron√≥metro';
            document.getElementById('progress').style.width = '0%';

            document.getElementById('report-container').classList.remove('active');
            document.getElementById('practice-area').classList.remove('hidden');

            generateQuestion();
        }

        // Inicializar
        loadHistory();
        updateSelectedDisplay();
        generateQuestion();
    </script>
</body>
</html>
